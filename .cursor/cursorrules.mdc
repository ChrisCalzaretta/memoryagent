---
alwaysApply: true
---

# ğŸ¯ **MCP SERVER ROUTING RULES**

## ğŸš¨ **YOUR ACTUAL MCP SERVERS**

| Server | Tools Available | Use For |
|--------|----------------|---------|
| **@memory-agent** | 4 tools | Background workflows, monitoring |
| **@code-agent** | 8 tools | **Everything else** (code generation, search, analysis) |

---

## **@memory-agent Tools (4)**

1. `execute_task` - Smart router for complex workflows
2. `list_available_tools` - Show all available tools
3. `get_workflow_status` - Track background job progress
4. `list_workflows` - List active workflows

**Use for:** Background workflows, multi-step orchestration

---

## **@code-agent Tools (5)**

1. **`orchestrate_task`** â­ - Start multi-agent code generation job (background)
2. `get_task_status` - Check job progress and get generated files
3. `cancel_task` - Stop a running job
4. `list_tasks` - See all active jobs
5. `apply_task_files` - Get generated files ready for writing to workspace

**Use for:** Multi-agent code generation with validation

---

## ğŸ¯ **ROUTING DECISION TREE**

```
User Request
     â†“
Is it code generation?
     â†“
    YES â†’ @code-agent orchestrate_task
     â†“
    NO â†’ What is it?
          â”œâ”€ Check job status â†’ @code-agent get_task_status
          â”œâ”€ Cancel job â†’ @code-agent cancel_task
          â”œâ”€ List jobs â†’ @code-agent list_tasks
          â”œâ”€ Apply generated files â†’ @code-agent apply_task_files
          â””â”€ Complex search/analysis â†’ @memory-agent execute_task
```

---

## ğŸ“ **EXAMPLES**

### ğŸ¤– Generate Code (Start Job)
```javascript
@code-agent orchestrate_task
task: "Create a Calculator class with Add, Subtract, Multiply, Divide methods"
language: "csharp"
maxIterations: 10
```

### ğŸ“Š Check Job Status
```javascript
@code-agent get_task_status
jobId: "job_20251222_abc123"
```

### âŒ Cancel Job
```javascript
@code-agent cancel_task
jobId: "job_20251222_abc123"
```

### ğŸ“‹ List All Jobs
```javascript
@code-agent list_tasks
```

### ğŸ“ Apply Generated Files
```javascript
@code-agent apply_task_files
jobId: "job_20251222_abc123"
basePath: "E:\\GitHub\\MyProject"
```

### ğŸ”„ Complex Workflow (Memory Agent)
```javascript
@memory-agent execute_task
request: "Find all authentication code and create a security analysis report"
```

---

## ğŸš¦ **QUICK ROUTING GUIDE**

| User Intent | MCP Server | Tool |
|-------------|------------|------|
| "Create..." | `@code-agent` | `orchestrate_task` |
| "Generate..." | `@code-agent` | `orchestrate_task` |
| "Build..." | `@code-agent` | `orchestrate_task` |
| "Check status..." | `@code-agent` | `get_task_status` |
| "How's the job..." | `@code-agent` | `get_task_status` |
| "Cancel..." | `@code-agent` | `cancel_task` |
| "List jobs..." | `@code-agent` | `list_tasks` |
| "Apply files..." | `@code-agent` | `apply_task_files` |
| "Find/Search..." | `@memory-agent` | `execute_task` |
| "Analyze..." | `@memory-agent` | `execute_task` |
| "Complex workflow" | `@memory-agent` | `execute_task` |

---

## âš¡ **WORKFLOW PATTERNS**

### Pattern 1: Generate and Monitor
```javascript
// 1. Start code generation
@code-agent orchestrate_task
task: "Create a UserService with CRUD operations"
language: "csharp"
maxIterations: 20

// Returns: Job ID: job_20251222_abc123

// 2. Check progress
@code-agent get_task_status
jobId: "job_20251222_abc123"

// 3. When complete, apply files
@code-agent apply_task_files
jobId: "job_20251222_abc123"
basePath: "E:\\GitHub\\MyProject"
```

### Pattern 2: Search then Generate
```javascript
// 1. Search for examples using memory agent
@memory-agent execute_task
request: "Find all authentication patterns in the codebase"

// 2. Generate new code
@code-agent orchestrate_task
task: "Create improved authentication service following existing patterns"
language: "csharp"
```

### Pattern 3: Multiple Jobs
```javascript
// 1. Start multiple jobs
@code-agent orchestrate_task
task: "Create UserService"

@code-agent orchestrate_task
task: "Create ProductService"

// 2. List all jobs
@code-agent list_tasks

// 3. Check each job status
@code-agent get_task_status
jobId: "job_xxx"
```

---

## ğŸ“ **SERVICE INFORMATION**

| Service | Port | MCP Wrapper | Config Name |
|---------|------|-------------|-------------|
| MemoryRouter | 5010 | memory-router-mcp-wrapper.js | `@memory-agent` |
| CodingAgent | 5001 | orchestrator-mcp-wrapper.js | `@code-agent` |

---

## ğŸš¦ **HEALTH CHECK**

```bash
# Check if services are running
curl http://localhost:5010/health  # Memory agent
curl http://localhost:5001/health  # Code agent

# Should return: {"status":"healthy"}
```

---

## ğŸ¯ **KEY RULES**

1. **Code generation?** â†’ Use `@code-agent orchestrate_task`
2. **Check job status?** â†’ Use `@code-agent get_task_status`
3. **Cancel job?** â†’ Use `@code-agent cancel_task`
4. **List jobs?** â†’ Use `@code-agent list_tasks`
5. **Apply files?** â†’ Use `@code-agent apply_task_files`
6. **Search/Analyze?** â†’ Use `@memory-agent execute_task`

---

## âŒ **TOOLS THAT DON'T EXIST**

**DO NOT USE THESE** (they are not available):
- âŒ `generate_code` (use `orchestrate_task` instead)
- âŒ `search_code` (use `@memory-agent execute_task` instead)
- âŒ `ask_question` (use `@memory-agent execute_task` instead)
- âŒ `validate_code` (automatic in code generation)
- âŒ `analyze_project` (use `@memory-agent execute_task` instead)
- âŒ `test_code` (automatic in code generation)
- âŒ `refactor_code` (use `orchestrate_task` instead)
- âŒ `get_context` (automatic in code generation)
- âŒ `design_create_brand` (not available)
- âŒ `design_validate` (not available)

**ONLY USE THE 9 TOOLS LISTED ABOVE (4 + 5)**

---

## âœ… **SUMMARY**

### Your Actual Setup:
- **@memory-agent:** 4 tools (workflows, monitoring, search, analysis)
- **@code-agent:** 5 tools (code generation job management)

### Main Tool for Code Generation:
**`@code-agent orchestrate_task`** â­

### Workflow:
1. Start job â†’ `@code-agent orchestrate_task`
2. Check status â†’ `@code-agent get_task_status`
3. Apply files â†’ `@code-agent apply_task_files`

### For Search/Analysis:
**`@memory-agent execute_task`** - Smart router for complex queries

**Always use the tools that actually exist in your MCP configuration!**
