<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 1100" font-family="'Segoe UI', system-ui, -apple-system, sans-serif">
  <defs>
    <!-- Gradients -->
    <linearGradient id="orchestratorGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#667eea"/>
      <stop offset="100%" style="stop-color:#764ba2"/>
    </linearGradient>
    <linearGradient id="codingGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#11998e"/>
      <stop offset="100%" style="stop-color:#38ef7d"/>
    </linearGradient>
    <linearGradient id="validationGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#fc4a1a"/>
      <stop offset="100%" style="stop-color:#f7b733"/>
    </linearGradient>
    <linearGradient id="memoryGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#00b4db"/>
      <stop offset="100%" style="stop-color:#0083b0"/>
    </linearGradient>
    <linearGradient id="dbGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#2c3e50"/>
      <stop offset="100%" style="stop-color:#3498db"/>
    </linearGradient>
    <linearGradient id="userGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#8e44ad"/>
      <stop offset="100%" style="stop-color:#9b59b6"/>
    </linearGradient>
    
    <!-- Shadow filter -->
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="3" dy="3" stdDeviation="4" flood-opacity="0.3"/>
    </filter>
    
    <!-- Arrow marker -->
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#555"/>
    </marker>
    <marker id="arrowheadBlue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#0083b0"/>
    </marker>
    <marker id="arrowheadGreen" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#11998e"/>
    </marker>
    <marker id="arrowheadOrange" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#fc4a1a"/>
    </marker>
    <marker id="arrowheadPurple" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#667eea"/>
    </marker>
  </defs>
  
  <!-- Background -->
  <rect width="100%" height="100%" fill="#0d1117"/>
  
  <!-- Title -->
  <text x="700" y="50" text-anchor="middle" font-size="32" font-weight="700" fill="#f0f6fc">
    ğŸ¤– Multi-Agent Code Generation Architecture
  </text>
  <text x="700" y="80" text-anchor="middle" font-size="16" fill="#8b949e">
    Agent Lightning Memory System + Iterative Coding-Validation Loop
  </text>
  
  <!-- User/Cursor IDE -->
  <g transform="translate(100, 150)">
    <rect width="220" height="140" rx="15" fill="url(#userGrad)" filter="url(#shadow)"/>
    <text x="110" y="35" text-anchor="middle" font-size="18" font-weight="600" fill="white">ğŸ‘¨â€ğŸ’» User / Cursor</text>
    <text x="110" y="55" text-anchor="middle" font-size="12" fill="#e0e0e0">IDE with MCP Client</text>
    <line x1="15" y1="68" x2="205" y2="68" stroke="rgba(255,255,255,0.3)"/>
    <text x="110" y="88" text-anchor="middle" font-size="11" fill="#ffd700">ğŸ”µ Direct: MCP Tools (25+)</text>
    <text x="110" y="106" text-anchor="middle" font-size="10" fill="#c0c0c0">smartsearch, store_qa, validate...</text>
    <text x="110" y="124" text-anchor="middle" font-size="11" fill="#d8b4fe">ğŸŸ£ Tasks: Orchestrator API</text>
  </g>
  
  <!-- Arrow: User to Orchestrator -->
  <path d="M 300 210 L 450 310" stroke="#9b59b6" stroke-width="3" fill="none" marker-end="url(#arrowheadPurple)"/>
  <text x="350" y="245" font-size="11" fill="#9b59b6" transform="rotate(33 350 245)">1a. OrchestrateTask</text>
  
  <!-- Arrow: User/Cursor DIRECTLY to MemoryAgent (MCP Tools) -->
  <path d="M 200 270 Q 200 600, 500 850" stroke="#00b4db" stroke-width="3" fill="none" marker-end="url(#arrowheadBlue)"/>
  <text x="240" y="520" font-size="12" fill="#00b4db" font-weight="600">1b. MCP Tools</text>
  <text x="240" y="538" font-size="10" fill="#38bdf8">(smartsearch, store_qa,</text>
  <text x="240" y="554" font-size="10" fill="#38bdf8">get_context, etc.)</text>
  
  <!-- CodingOrchestrator (Center) -->
  <g transform="translate(450, 280)">
    <rect width="320" height="180" rx="15" fill="url(#orchestratorGrad)" filter="url(#shadow)"/>
    <text x="160" y="35" text-anchor="middle" font-size="20" font-weight="700" fill="white">ğŸ¯ CodingOrchestrator</text>
    <text x="160" y="58" text-anchor="middle" font-size="12" fill="#e0e0e0">Port: 5003 | TaskOrchestrator.cs</text>
    <line x1="20" y1="72" x2="300" y2="72" stroke="rgba(255,255,255,0.3)" stroke-width="1"/>
    
    <text x="25" y="95" font-size="13" fill="#f0f0f0">ğŸ“‹ JobManager</text>
    <text x="25" y="115" font-size="11" fill="#d0d0d0">â€¢ Manages async job queues</text>
    <text x="25" y="135" font-size="11" fill="#d0d0d0">â€¢ Tracks phase timeline</text>
    
    <text x="170" y="95" font-size="13" fill="#f0f0f0">ğŸ”„ Iteration Loop</text>
    <text x="170" y="115" font-size="11" fill="#d0d0d0">â€¢ Max 5 iterations</text>
    <text x="170" y="135" font-size="11" fill="#d0d0d0">â€¢ Min score: 8/10</text>
    
    <text x="25" y="160" font-size="11" fill="#ffd700">âš¡ HTTP Clients â†’ All Agents</text>
  </g>
  
  <!-- CodingAgent (Left) -->
  <g transform="translate(80, 550)">
    <rect width="280" height="200" rx="15" fill="url(#codingGrad)" filter="url(#shadow)"/>
    <text x="140" y="35" text-anchor="middle" font-size="18" font-weight="600" fill="white">âš¡ CodingAgent</text>
    <text x="140" y="55" text-anchor="middle" font-size="12" fill="#e0e0e0">Port: 5001</text>
    <line x1="20" y1="68" x2="260" y2="68" stroke="rgba(255,255,255,0.3)" stroke-width="1"/>
    
    <text x="25" y="92" font-size="13" fill="#f0f0f0">ğŸ› ï¸ CodeGenerationService</text>
    <text x="25" y="115" font-size="11" fill="#d0d0d0">â€¢ POST /api/agent/generate</text>
    <text x="25" y="135" font-size="11" fill="#d0d0d0">â€¢ POST /api/agent/fix</text>
    
    <text x="25" y="160" font-size="13" fill="#f0f0f0">ğŸ“ PromptBuilder</text>
    <text x="25" y="180" font-size="11" fill="#d0d0d0">â€¢ Builds LLM prompts from context</text>
  </g>
  
  <!-- Arrow: Orchestrator to CodingAgent -->
  <path d="M 530 460 L 280 550" stroke="#11998e" stroke-width="3" fill="none" marker-end="url(#arrowheadGreen)"/>
  <text x="380" y="485" font-size="11" fill="#38ef7d" transform="rotate(-40 380 485)">3. Generate/Fix Code</text>
  
  <!-- Arrow: CodingAgent back to Orchestrator -->
  <path d="M 320 560 L 530 470" stroke="#11998e" stroke-width="2" stroke-dasharray="5,3" fill="none" marker-end="url(#arrowheadGreen)"/>
  <text x="450" y="540" font-size="10" fill="#38ef7d" transform="rotate(-35 450 540)">FileChanges[]</text>
  
  <!-- ValidationAgent (Right) -->
  <g transform="translate(1040, 550)">
    <rect width="280" height="200" rx="15" fill="url(#validationGrad)" filter="url(#shadow)"/>
    <text x="140" y="35" text-anchor="middle" font-size="18" font-weight="600" fill="white">âœ… ValidationAgent</text>
    <text x="140" y="55" text-anchor="middle" font-size="12" fill="#e0e0e0">Port: 5002</text>
    <line x1="20" y1="68" x2="260" y2="68" stroke="rgba(255,255,255,0.3)" stroke-width="1"/>
    
    <text x="25" y="92" font-size="13" fill="#f0f0f0">ğŸ” ValidationService</text>
    <text x="25" y="115" font-size="11" fill="#d0d0d0">â€¢ POST /api/agent/validate</text>
    <text x="25" y="135" font-size="11" fill="#d0d0d0">â€¢ Score 0-10, Pass â‰¥ 8</text>
    
    <text x="25" y="160" font-size="13" fill="#f0f0f0">ğŸ“‹ Rules</text>
    <text x="25" y="180" font-size="11" fill="#d0d0d0">â€¢ Security, Best Practices, Patterns</text>
  </g>
  
  <!-- Arrow: Orchestrator to ValidationAgent -->
  <path d="M 690 460 L 1120 550" stroke="#fc4a1a" stroke-width="3" fill="none" marker-end="url(#arrowheadOrange)"/>
  <text x="920" y="485" font-size="11" fill="#f7b733" transform="rotate(40 920 485)">4. ValidateCode</text>
  
  <!-- Arrow: ValidationAgent back to Orchestrator -->
  <path d="M 1080 560 L 690 470" stroke="#fc4a1a" stroke-width="2" stroke-dasharray="5,3" fill="none" marker-end="url(#arrowheadOrange)"/>
  <text x="870" y="535" font-size="10" fill="#f7b733" transform="rotate(35 870 535)">Score + Issues[]</text>
  
  <!-- MemoryAgent / Lightning (Bottom Center) -->
  <g transform="translate(480, 800)">
    <rect width="440" height="220" rx="15" fill="url(#memoryGrad)" filter="url(#shadow)"/>
    <text x="220" y="35" text-anchor="middle" font-size="20" font-weight="700" fill="white">ğŸ§  MemoryAgent (Lightning)</text>
    <text x="220" y="58" text-anchor="middle" font-size="12" fill="#e0e0e0">Port: 5000 | MCP Server</text>
    <line x1="20" y1="72" x2="420" y2="72" stroke="rgba(255,255,255,0.3)" stroke-width="1"/>
    
    <text x="25" y="98" font-size="13" fill="#f0f0f0">ğŸ”§ MCP Tools (25+)</text>
    <text x="25" y="118" font-size="11" fill="#d0d0d0">â€¢ smartsearch, get_context</text>
    <text x="25" y="138" font-size="11" fill="#d0d0d0">â€¢ store_qa, find_similar_questions</text>
    <text x="25" y="158" font-size="11" fill="#d0d0d0">â€¢ validate, get_recommendations</text>
    
    <text x="230" y="98" font-size="13" fill="#f0f0f0">ğŸ“Š Learning System</text>
    <text x="230" y="118" font-size="11" fill="#d0d0d0">â€¢ Q&A storage for recall</text>
    <text x="230" y="138" font-size="11" fill="#d0d0d0">â€¢ Prompt feedback â†’ RL</text>
    <text x="230" y="158" font-size="11" fill="#d0d0d0">â€¢ Pattern evolution</text>
    
    <text x="25" y="185" font-size="11" fill="#ffd700">âš¡ Auto-session, Auto-file tracking</text>
    <text x="25" y="205" font-size="11" fill="#ffd700">ğŸ“¡ Endpoints: /sse, /mcp, /api/mcp/call</text>
  </g>
  
  <!-- Arrow: Orchestrator to MemoryAgent (GetContext) - DOWN -->
  <path d="M 580 460 L 580 800" stroke="#0083b0" stroke-width="4" fill="none" marker-end="url(#arrowheadBlue)"/>
  <text x="530" y="560" font-size="12" fill="#00b4db" font-weight="600">2. GetContext()</text>
  <text x="530" y="580" font-size="10" fill="#38bdf8">task, patterns, Q&A</text>
  
  <!-- Arrow: Orchestrator to MemoryAgent (StoreQA) - DOWN separate -->
  <path d="M 640 460 L 640 800" stroke="#0083b0" stroke-width="4" fill="none" marker-end="url(#arrowheadBlue)"/>
  <text x="650" y="620" font-size="12" fill="#00b4db" font-weight="600">6. StoreQA()</text>
  <text x="650" y="640" font-size="10" fill="#38bdf8">question, answer</text>
  <text x="650" y="700" font-size="12" fill="#00b4db" font-weight="600">6. Feedback()</text>
  <text x="650" y="720" font-size="10" fill="#38bdf8">prompt rating</text>
  
  <!-- Arrow: MemoryAgent back to Orchestrator (context response) -->
  <path d="M 560 800 L 560 460" stroke="#0083b0" stroke-width="2" stroke-dasharray="6,3" fill="none" marker-end="url(#arrowheadBlue)"/>
  <text x="505" y="680" font-size="10" fill="#38bdf8">CodeContext</text>
  
  <!-- Arrow: ValidationAgent to MemoryAgent -->
  <path d="M 1180 750 L 900 850" stroke="#0083b0" stroke-width="2" stroke-dasharray="5,3" fill="none" marker-end="url(#arrowheadBlue)"/>
  <text x="1060" y="780" font-size="10" fill="#00b4db" transform="rotate(30 1060 780)">Query patterns</text>
  
  <!-- Infrastructure Boxes -->
  <!-- Qdrant -->
  <g transform="translate(130, 880)">
    <rect width="140" height="100" rx="10" fill="url(#dbGrad)" filter="url(#shadow)"/>
    <text x="70" y="30" text-anchor="middle" font-size="14" font-weight="600" fill="white">ğŸ“Š Qdrant</text>
    <text x="70" y="50" font-size="10" fill="#d0d0d0" text-anchor="middle">Vector Database</text>
    <text x="70" y="70" font-size="9" fill="#a0a0a0" text-anchor="middle">Port: 6333</text>
    <text x="70" y="85" font-size="9" fill="#a0a0a0" text-anchor="middle">Embeddings + Semantic</text>
  </g>
  
  <!-- Neo4j -->
  <g transform="translate(290, 880)">
    <rect width="140" height="100" rx="10" fill="url(#dbGrad)" filter="url(#shadow)"/>
    <text x="70" y="30" text-anchor="middle" font-size="14" font-weight="600" fill="white">ğŸ•¸ï¸ Neo4j</text>
    <text x="70" y="50" font-size="10" fill="#d0d0d0" text-anchor="middle">Graph Database</text>
    <text x="70" y="70" font-size="9" fill="#a0a0a0" text-anchor="middle">Port: 7687</text>
    <text x="70" y="85" font-size="9" fill="#a0a0a0" text-anchor="middle">Code Relationships</text>
  </g>
  
  <!-- Ollama -->
  <g transform="translate(970, 880)">
    <rect width="140" height="100" rx="10" fill="url(#dbGrad)" filter="url(#shadow)"/>
    <text x="70" y="30" text-anchor="middle" font-size="14" font-weight="600" fill="white">ğŸ¦™ Ollama</text>
    <text x="70" y="50" font-size="10" fill="#d0d0d0" text-anchor="middle">Local LLM</text>
    <text x="70" y="70" font-size="9" fill="#a0a0a0" text-anchor="middle">Port: 11434</text>
    <text x="70" y="85" font-size="9" fill="#a0a0a0" text-anchor="middle">mxbai-embed-large</text>
  </g>
  
  <!-- Connection lines to infrastructure -->
  <line x1="480" y1="950" x2="270" y2="920" stroke="#3498db" stroke-width="1.5"/>
  <line x1="500" y1="950" x2="380" y2="920" stroke="#3498db" stroke-width="1.5"/>
  <line x1="900" y1="950" x2="990" y2="920" stroke="#3498db" stroke-width="1.5"/>
  
  <!-- Flow Legend Box -->
  <g transform="translate(1000, 130)">
    <rect width="370" height="310" rx="10" fill="rgba(30, 35, 45, 0.9)" stroke="#444" stroke-width="1"/>
    <text x="185" y="30" text-anchor="middle" font-size="16" font-weight="600" fill="#f0f6fc">ğŸ“œ Communication Flow</text>
    <line x1="20" y1="45" x2="350" y2="45" stroke="#444"/>
    
    <text x="25" y="68" font-size="11" font-weight="600" fill="#00b4db">ğŸ”µ User â†’ MemoryAgent (Direct MCP)</text>
    <text x="25" y="85" font-size="10" fill="#c9d1d9">1b. Cursor uses 25+ MCP tools directly</text>
    
    <line x1="20" y1="97" x2="350" y2="97" stroke="#333"/>
    <text x="25" y="115" font-size="11" font-weight="600" fill="#9b59b6">ğŸŸ£ Orchestrated Task Flow</text>
    
    <text x="25" y="135" font-size="10" fill="#9b59b6">1a.</text>
    <text x="50" y="135" font-size="10" fill="#c9d1d9">User â†’ OrchestrateTaskRequest</text>
    
    <text x="25" y="153" font-size="10" fill="#00b4db">2.</text>
    <text x="50" y="153" font-size="10" fill="#c9d1d9">Orchestrator â†’ GetContext() â†’ Memory</text>
    
    <text x="25" y="171" font-size="10" fill="#38ef7d">3.</text>
    <text x="50" y="171" font-size="10" fill="#c9d1d9">Orchestrator â†’ Generate/Fix â†’ CodingAgent</text>
    
    <text x="25" y="189" font-size="10" fill="#f7b733">4.</text>
    <text x="50" y="189" font-size="10" fill="#c9d1d9">Orchestrator â†’ Validate â†’ ValidationAgent</text>
    
    <text x="25" y="207" font-size="10" fill="#667eea">5.</text>
    <text x="50" y="207" font-size="10" fill="#c9d1d9">If score &lt; 8 â†’ Loop back to step 3</text>
    
    <text x="25" y="225" font-size="10" fill="#00b4db">6.</text>
    <text x="50" y="225" font-size="10" fill="#c9d1d9">Orchestrator â†’ StoreQA/Feedback â†’ Memory</text>
    
    <text x="25" y="243" font-size="10" fill="#9b59b6">7.</text>
    <text x="50" y="243" font-size="10" fill="#c9d1d9">Orchestrator â†’ Files â†’ User</text>
    
    <line x1="20" y1="255" x2="350" y2="255" stroke="#333"/>
    <text x="25" y="275" font-size="10" fill="#f7b733">âš ï¸ ValidationAgent â†’ MemoryAgent</text>
    <text x="25" y="290" font-size="10" fill="#8b949e">   Queries patterns for validation</text>
    
    <text x="25" y="305" font-size="9" fill="#666">âš¡ Max 5 iterations | Min score 8/10</text>
  </g>
  
  <!-- Iteration Loop Indicator -->
  <g transform="translate(700, 530)">
    <path d="M 0 0 C 80 0, 120 60, 80 100 C 40 140, -40 140, -80 100 C -120 60, -80 0, 0 0" 
          stroke="#667eea" stroke-width="3" fill="none" stroke-dasharray="8,4" marker-end="url(#arrowheadPurple)"/>
    <text x="0" y="55" text-anchor="middle" font-size="12" font-weight="600" fill="#667eea">5. Loop</text>
    <text x="0" y="72" text-anchor="middle" font-size="10" fill="#8b949e">until pass</text>
  </g>
  
  <!-- Communication Protocol Legend -->
  <g transform="translate(100, 360)">
    <rect width="180" height="150" rx="8" fill="rgba(30, 35, 45, 0.9)" stroke="#444"/>
    <text x="90" y="22" text-anchor="middle" font-size="12" font-weight="600" fill="#f0f6fc">ğŸ“¡ Protocols</text>
    <line x1="10" y1="32" x2="170" y2="32" stroke="#444"/>
    
    <circle cx="20" cy="52" r="6" fill="#667eea"/>
    <text x="35" y="56" font-size="10" fill="#c9d1d9">HTTP REST (Agents)</text>
    
    <circle cx="20" cy="74" r="6" fill="#00b4db"/>
    <text x="35" y="78" font-size="10" fill="#c9d1d9">MCP JSON-RPC</text>
    
    <circle cx="20" cy="96" r="6" fill="#3498db"/>
    <text x="35" y="100" font-size="10" fill="#c9d1d9">SSE (Cursor â†” MCP)</text>
    
    <line x1="10" y1="112" x2="170" y2="112" stroke="#444"/>
    <text x="90" y="128" text-anchor="middle" font-size="9" fill="#8b949e">ğŸ”µ = Direct MCP path</text>
    <text x="90" y="142" text-anchor="middle" font-size="9" fill="#8b949e">ğŸŸ£ = Orchestrated path</text>
  </g>
  
</svg>

